{
  "openapi": "3.0.0",
  "info": {
    "title": "E-commerce API",
    "version": "1.0.0",
    "description": "API documentation for the E-commerce platform."
  },
  "servers": [
    {
      "url": "http://localhost:5000/api",
      "description": "Local server"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/users": {
      "get": {
        "summary": "Get all users",
        "tags": ["Users"],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "example": [
                  { "id": "64f1c72d8a1f3c4567d89ab1", "name": "John Doe", "email": "john@example.com", "role": "user" },
                  { "id": "64f1c72d8a1f3c4567d89ab2", "name": "Jane Admin", "email": "jane@example.com", "role": "admin" }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new user",
        "tags": ["Users"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UserCreate" },
              "example": { "name": "Alice Johnson", "email": "alice@example.com", "password": "Password123!", "role": "user" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully",
            "content": {
              "application/json": {
                "example": { "id": "64f1c72d8a1f3c4567d89ab9", "name": "Alice Johnson", "email": "alice@example.com", "role": "user" }
              }
            }
          },
          "400": { "description": "Bad request" }
        }
      }
    },

    "/users/{id}": {
      "parameters": [
        { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
      ],
      "get": {
        "summary": "Get user by id",
        "tags": ["Users"],
        "responses": {
          "200": { "description": "User found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserResponse" }, "example": { "id": "64f1c72d8a1f3c4567d89ab1", "name": "John Doe", "email": "john@example.com", "role": "user" } } } },
          "404": { "description": "User not found" }
        }
      },
      "put": {
        "summary": "Update a user",
        "tags": ["Users"],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserUpdate" }, "example": { "name": "John Updated", "address": "22 New Ave" } } }
        },
        "responses": {
          "200": { "description": "User updated", "content": { "application/json": { "example": { "id": "64f1c72d8a1f3c4567d89ab1", "name": "John Updated", "email": "john@example.com" } } } },
          "400": { "description": "Invalid request" },
          "404": { "description": "User not found" }
        }
      },
      "delete": {
        "summary": "Delete a user",
        "tags": ["Users"],
        "responses": {
          "200": { "description": "User deleted", "content": { "application/json": { "example": { "message": "User deleted" } } } },
          "404": { "description": "User not found" }
        }
      }
    },

    "/products": {
      "get": {
        "summary": "Get all products",
        "tags": ["Products"],
        "responses": {
          "200": {
            "description": "List of products",
            "content": {
              "application/json": {
                "example": [
                  {
                    "id": "6500b12f9d12345678c9ab30",
                    "name": "iPhone 14 Pro",
                    "description": "Latest Apple smartphone",
                    "price": 1200,
                    "stock": 15,
                    "category": "Electronics",
                    "images": ["https://example.com/iphone14.jpg"],
                    "isFeatured": true
                  }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new product (admin)",
        "tags": ["Products"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": { "schema": { "$ref": "#/components/schemas/ProductCreateMultipart" } },
            "application/json": { "schema": { "$ref": "#/components/schemas/ProductCreate" }, "example": { "name": "Samsung Galaxy S23", "description": "High-end Android smartphone", "price": 1000, "stock": 25, "category": "Electronics", "images": ["https://example.com/galaxys23.jpg"], "isFeatured": false } }
          }
        },
        "responses": {
          "201": { "description": "Product created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" }, "example": { "id": "6500b22f9d12345678c9ab33", "name": "Samsung Galaxy S23", "price": 1000 } } } },
          "400": { "description": "Bad request" }
        }
      }
    },

    "/products/{id}": {
      "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }],
      "get": {
        "summary": "Get product by id",
        "tags": ["Products"],
        "responses": {
          "200": { "description": "Product found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } } },
          "404": { "description": "Product not found" }
        }
      },
      "put": {
        "summary": "Update a product",
        "tags": ["Products"],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProductUpdate" }, "example": { "price": 950, "stock": 30 } } }
        },
        "responses": { "200": { "description": "Product updated", "content": { "application/json": { "example": { "id": "6500b22f9d12345678c9ab33", "name": "Samsung Galaxy S23", "price": 950, "stock": 30 } } } }, "404": { "description": "Product not found" } }
      },
      "delete": {
        "summary": "Delete a product",
        "tags": ["Products"],
        "responses": { "200": { "description": "Product deleted", "content": { "application/json": { "example": { "message": "Product deleted" } } } }, "404": { "description": "Product not found" } }
      }
    },

    "/orders": {
      "get": {
        "summary": "Get all orders",
        "tags": ["Orders"],
        "responses": {
          "200": {
            "description": "List of orders",
            "content": {
              "application/json": {
                "example": [
                  { "id": "6500c32f9d12345678c9ab44", "user": "64f1c72d8a1f3c4567d89ab1", "totalPrice": 2000, "orderStatus": "processing" }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new order",
        "tags": ["Orders"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/OrderCreate" },
              "example": {
                "user": "64f1c72d8a1f3c4567d89ab1",
                "orderItems": [{ "product": "6500b22f9d12345678c9ab33", "quantity": 2, "price": 1000 }],
                "shippingAddress": { "address": "123 Main St", "city": "New York", "postalCode": "10001", "country": "USA" },
                "paymentMethod": "paypal",
                "totalPrice": 2000
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Order created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Order" }, "example": { "id": "6500c32f9d12345678c9ab44", "orderStatus": "pending", "totalPrice": 2000 } } } },
          "400": { "description": "Bad request" }
        }
      }
    },

    "/orders/{id}": {
      "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }],
      "get": {
        "summary": "Get order by id",
        "tags": ["Orders"],
        "responses": { "200": { "description": "Order found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Order" } } } }, "404": { "description": "Order not found" } }
      },
      "put": {
        "summary": "Update an order (status/payment)",
        "tags": ["Orders"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/OrderUpdate" }, "example": { "orderStatus": "shipped", "paymentStatus": "completed" } } } },
        "responses": { "200": { "description": "Order updated", "content": { "application/json": { "example": { "id": "6500c32f9d12345678c9ab44", "orderStatus": "shipped" } } } }, "404": { "description": "Order not found" } }
      },
      "delete": {
        "summary": "Delete an order",
        "tags": ["Orders"],
        "responses": { "200": { "description": "Order deleted", "content": { "application/json": { "example": { "message": "Order deleted" } } } }, "404": { "description": "Order not found" } }
      }
    },

    "/categories": {
      "get": {
        "summary": "Get all categories",
        "tags": ["Categories"],
        "responses": { "200": { "description": "List of categories", "content": { "application/json": { "example": [ { "id": "6500d42f9d12345678c9ab55", "name": "Electronics", "description": "Devices and gadgets" } ] } } } }
      },
      "post": {
        "summary": "Create a category",
        "tags": ["Categories"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Category" }, "example": { "name": "Home", "description": "Household items" } } } },
        "responses": { "201": { "description": "Category created", "content": { "application/json": { "example": { "id": "6500d42f9d12345678c9ab55", "name": "Home" } } } } }
      }
    },

    "/categories/{id}": {
      "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }],
      "get": { "summary": "Get category by id", "tags": ["Categories"], "responses": { "200": { "description": "Category found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Category" } } } }, "404": { "description": "Category not found" } } },
      "put": { "summary": "Update category", "tags": ["Categories"], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Category" }, "example": { "name": "Electronics & Gadgets", "description": "Updated description" } } } }, "responses": { "200": { "description": "Category updated" }, "404": { "description": "Category not found" } } },
      "delete": { "summary": "Delete category", "tags": ["Categories"], "responses": { "200": { "description": "Category deleted" }, "404": { "description": "Category not found" } } }
    },

    "/cart": {
      "get": {
        "summary": "Get all carts (admin)",
        "tags": ["Cart"],
        "responses": { "200": { "description": "List of carts", "content": { "application/json": { "example": [ { "user": "64f1c72d8a1f3c4567d89ab1", "items": [ { "product": "6500b22f9d12345678c9ab33", "quantity": 2 } ] } ] } } } }
      }
    },

    "/cart/{userId}": {
      "parameters": [{ "name": "userId", "in": "path", "required": true, "schema": { "type": "string" } }],
      "get": {
        "summary": "Get a user's cart",
        "tags": ["Cart"],
        "responses": { "200": { "description": "User cart", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Cart" }, "example": { "user": "64f1c72d8a1f3c4567d89ab1", "items": [ { "product": "6500b22f9d12345678c9ab33", "quantity": 2 } ] } } } }, "404": { "description": "Cart not found" } }
      },
      "post": {
        "summary": "Add item to user's cart",
        "tags": ["Cart"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CartAddItem" }, "example": { "product": "6500b22f9d12345678c9ab33", "quantity": 1 } } } },
        "responses": { "201": { "description": "Item added", "content": { "application/json": { "example": { "user": "64f1c72d8a1f3c4567d89ab1", "items": [ { "product": "6500b22f9d12345678c9ab33", "quantity": 1 } ] } } } } }
      },
      "put": {
        "summary": "Update item quantity in user's cart",
        "tags": ["Cart"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CartAddItem" }, "example": { "product": "6500b22f9d12345678c9ab33", "quantity": 3 } } } },
        "responses": { "200": { "description": "Cart updated", "content": { "application/json": { "example": { "user": "64f1c72d8a1f3c4567d89ab1", "items": [ { "product": "6500b22f9d12345678c9ab33", "quantity": 3 } ] } } } } }
      },
      "delete": {
        "summary": "Clear entire user's cart",
        "tags": ["Cart"],
        "responses": { "200": { "description": "Cart cleared", "content": { "application/json": { "example": { "message": "Cart cleared" } } } }, "404": { "description": "Cart not found" } }
      }
    },

    "/cart/{userId}/{productId}": {
      "parameters": [
        { "name": "userId", "in": "path", "required": true, "schema": { "type": "string" } },
        { "name": "productId", "in": "path", "required": true, "schema": { "type": "string" } }
      ],
      "delete": {
        "summary": "Remove a single product from user's cart",
        "tags": ["Cart"],
        "responses": { "200": { "description": "Product removed", "content": { "application/json": { "example": { "message": "Product removed from cart" } } } }, "404": { "description": "Not found" } }
      }
    },

    "/payments": {
      "get": {
        "summary": "Get all payments",
        "tags": ["Payments"],
        "responses": { "200": { "description": "List of payments", "content": { "application/json": { "example": [ { "id": "6500e52f9d12345678c9ab66", "order": "6500c32f9d12345678c9ab44", "status": "pending", "amount": 2000 } ] } } } }
      },
      "post": {
        "summary": "Create a new payment (record)",
        "tags": ["Payments"],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaymentCreate" }, "example": { "order": "6500c32f9d12345678c9ab44", "paymentId": "PAY-12345", "status": "completed", "amount": 2000, "paymentMethod": "paypal" } } } },
        "responses": { "201": { "description": "Payment created", "content": { "application/json": { "example": { "id": "6500e52f9d12345678c9ab66", "order": "6500c32f9d12345678c9ab44", "status": "completed", "amount": 2000 } } } } }
      }
    },

    "/payments/{id}": {
      "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }],
      "get": { "summary": "Get payment by id", "tags": ["Payments"], "responses": { "200": { "description": "Payment found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Payment" } } } }, "404": { "description": "Payment not found" } } },
      "put": { "summary": "Update payment", "tags": ["Payments"], "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PaymentUpdate" }, "example": { "status": "refunded" } } } }, "responses": { "200": { "description": "Payment updated" }, "404": { "description": "Payment not found" } } },
      "delete": { "summary": "Delete payment", "tags": ["Payments"], "responses": { "200": { "description": "Payment deleted" }, "404": { "description": "Payment not found" } } }
    },

    "/payments/paypal": {
      "post": {
        "summary": "Initiate a PayPal payment (create order on PayPal)",
        "tags": ["Payments"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["orderId", "amount", "currency"],
                "properties": {
                  "orderId": { "type": "string" },
                  "amount": { "type": "number" },
                  "currency": { "type": "string", "example": "USD" }
                }
              },
              "example": { "orderId": "6500c32f9d12345678c9ab44", "amount": 2000, "currency": "USD" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "PayPal approval URL returned",
            "content": {
              "application/json": {
                "example": { "paypalOrderId": "PAYPAL-EC-123456", "approvalUrl": "https://www.paypal.com/checkoutnow?token=PAYPAL-EC-123456" }
              }
            }
          }
        }
      }
    },

    "/payments/paypal/capture": {
      "post": {
        "summary": "Capture PayPal payment after approval",
        "tags": ["Payments"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "type": "object", "required": ["paypalOrderId"], "properties": { "paypalOrderId": { "type": "string" } } },
              "example": { "paypalOrderId": "PAYPAL-EC-123456" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "PayPal payment captured",
            "content": {
              "application/json": {
                "example": { "status": "COMPLETED", "transactionId": "TRANSACTION-98765", "paypalOrderId": "PAYPAL-EC-123456" }
              }
            }
          }
        }
      }
    },

    "/auth/admins/register": {
      "post": {
        "summary": "Register admin",
        "tags": ["Auth"],
        "security": [],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AdminRegister" }, "example": { "name": "Jane Admin", "email": "janeadmin@example.com", "password": "SecurePass123" } } } },
        "responses": { "201": { "description": "Admin registered", "content": { "application/json": { "example": { "id": "6500f62f9d12345678c9ab77", "name": "Jane Admin", "email": "janeadmin@example.com", "role": "admin" } } } }, "400": { "description": "Invalid input" } }
      }
    },

    "/auth/admins": {
      "get": {
        "summary": "Get all admins",
        "tags": ["Auth"],
        "responses": { "200": { "description": "List of admins", "content": { "application/json": { "example": [ { "id": "6500f62f9d12345678c9ab77", "name": "Jane Admin", "email": "janeadmin@example.com" } ] } } } }
      }
    },

    "/auth/login": {
      "post": {
        "summary": "Login (user or admin)",
        "tags": ["Auth"],
        "security": [],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LoginRequest" }, "example": { "email": "janeadmin@example.com", "password": "SecurePass123" } } } },
        "responses": {
          "200": {
            "description": "Login successful (returns token + user)",
            "content": {
              "application/json": {
                "example": { "token": "jwt_token_here", "user": { "id": "6500f62f9d12345678c9ab77", "name": "Jane Admin", "email": "janeadmin@example.com", "role": "admin" } }
              }
            }
          },
          "401": { "description": "Invalid credentials" }
        }
      }
    }
  },

  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    },
    "schemas": {
      "UserCreate": {
        "type": "object",
        "required": ["name", "email", "password"],
        "properties": {
          "name": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string" },
          "role": { "type": "string", "enum": ["user", "admin", "subadmin"], "default": "user" },
          "isOnline": { "type": "boolean" },
          "lastSeen": { "type": "string", "format": "date-time" },
          "address": { "type": "string" },
          "phone": { "type": "string" }
        }
      },
      "UserUpdate": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "email": { "type": "string", "format": "email" },
          "password": { "type": "string" },
          "address": { "type": "string" },
          "phone": { "type": "string" }
        }
      },
      "UserResponse": {
        "type": "object",
        "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "email": { "type": "string" }, "role": { "type": "string" } }
      },

      "Product": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number" },
          "stock": { "type": "integer" },
          "category": { "type": "string" },
          "images": { "type": "array", "items": { "type": "string" } },
          "isFeatured": { "type": "boolean" }
        }
      },
      "ProductCreate": {
        "type": "object",
        "required": ["name", "price", "stock"],
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number" },
          "stock": { "type": "integer" },
          "category": { "type": "string" },
          "images": { "type": "array", "items": { "type": "string", "format": "uri" } },
          "isFeatured": { "type": "boolean" }
        }
      },
      "ProductCreateMultipart": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number" },
          "stock": { "type": "integer" },
          "category": { "type": "string" },
          "image": { "type": "string", "format": "binary" }
        },
        "required": ["name", "price"]
      },
      "ProductUpdate": {
        "type": "object",
        "properties": { "name": { "type": "string" }, "description": { "type": "string" }, "price": { "type": "number" }, "stock": { "type": "integer" }, "category": { "type": "string" }, "images": { "type": "array", "items": { "type": "string" } } }
      },

      "OrderCreate": {
        "type": "object",
        "required": ["user", "orderItems", "shippingAddress", "paymentMethod", "totalPrice"],
        "properties": {
          "user": { "type": "string" },
          "orderItems": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["product", "quantity", "price"],
              "properties": {
                "product": { "type": "string" },
                "quantity": { "type": "integer" },
                "price": { "type": "number" }
              }
            }
          },
          "shippingAddress": {
            "type": "object",
            "required": ["address", "city", "postalCode", "country"],
            "properties": { "address": { "type": "string" }, "city": { "type": "string" }, "postalCode": { "type": "string" }, "country": { "type": "string" } }
          },
          "paymentMethod": { "type": "string" },
          "paymentStatus": { "type": "string" },
          "orderStatus": { "type": "string" },
          "totalPrice": { "type": "number" }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "user": { "type": "string" },
          "orderItems": { "type": "array", "items": { "type": "object", "properties": { "product": { "type": "string" }, "quantity": { "type": "integer" }, "price": { "type": "number" } } } },
          "shippingAddress": { "type": "object", "properties": { "address": { "type": "string" }, "city": { "type": "string" }, "postalCode": { "type": "string" }, "country": { "type": "string" } } },
          "paymentMethod": { "type": "string" },
          "paymentStatus": { "type": "string" },
          "orderStatus": { "type": "string" },
          "totalPrice": { "type": "number" }
        }
      },
      "OrderUpdate": {
        "type": "object",
        "properties": { "orderStatus": { "type": "string" }, "paymentStatus": { "type": "string" } }
      },

      "Category": {
        "type": "object",
        "required": ["name"],
        "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "description": { "type": "string" } }
      },

      "Cart": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "user": { "type": "string" },
          "items": { "type": "array", "items": { "type": "object", "properties": { "product": { "type": "string" }, "quantity": { "type": "integer" } } } }
        }
      },
      "CartAddItem": {
        "type": "object",
        "required": ["product", "quantity"],
        "properties": { "product": { "type": "string" }, "quantity": { "type": "integer", "minimum": 1 } }
      },

      "PaymentCreate": {
        "type": "object",
        "required": ["order", "amount", "paymentMethod"],
        "properties": {
          "order": { "type": "string" },
          "paymentId": { "type": "string" },
          "status": { "type": "string", "enum": ["pending", "completed", "failed"] },
          "amount": { "type": "number" },
          "paymentMethod": { "type": "string" }
        }
      },
      "Payment": {
        "type": "object",
        "properties": { "id": { "type": "string" }, "order": { "type": "string" }, "paymentId": { "type": "string" }, "status": { "type": "string" }, "amount": { "type": "number" }, "paymentMethod": { "type": "string" } }
      },
      "PaymentUpdate": { "type": "object", "properties": { "status": { "type": "string" } } },

      "AdminRegister": { "type": "object", "required": ["name", "email", "password"], "properties": { "name": { "type": "string" }, "email": { "type": "string" }, "password": { "type": "string" } } },
      "LoginRequest": { "type": "object", "required": ["email", "password"], "properties": { "email": { "type": "string" }, "password": { "type": "string" } } },
      "Admin": { "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "email": { "type": "string" }, "role": { "type": "string" } } },
      "AuthResponse": { "type": "object", "properties": { "token": { "type": "string" }, "user": { "$ref": "#/components/schemas/Admin" } } }
    }
  }
}
